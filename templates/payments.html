{% extends "layout.html" %}
{% block body %}
  <h2>Payment System Management</h2>
  <div class=welcometext>
	This interface alows you to sync member records with the payment system 
	<p>
	<div class="sectionhead">Payment system configuration</div>
	<ul>
	  <li>System: <i>{{ paysystem.module }}</i></li>
	  <li>User account: <i>{{ paysystem.userid }} </i></li>
	  <li>Endpoint: <i>{{ paysystem.uri }}</i></li>
	  <li>Last sync: {{ cdate.checked }}</li>
	</ul>
	<div class="sectionhead">Test Payment system connectivity</div>
	This test validates connectivity and access to the configured automated payment system. It should always be run before the ""synchronize" option below, just to be sure.
	<p>
	  
	</p><div class="paybuttons"><a href="{{ url_for('test_payments') }}"><button class="paysystem" onclick="this.disabled = true">Test (takes 5-20 seconds..)</button></a></div>
    <p>
	  
	</p><div class="sectionhead">Synchronize data with payment system</div>
	<div class="warning">Only do this if you suspect data is out of sync. Just sayin'.</div>
	<p></p>
	This action will:
	<ol>
	  <li>Extract a list of all subscribers and their attributes from the Payment system</li>
	  <li>Filter that list against known bad data</li>
	  <li>Update the Members table to add any missing members</li>
	  <li>Update the Members table to set the "Active" flag appropriately (expired payments = not active)</li>
	  <li>Update the Members table with the correct Plan for each member (eg Hobbyist that changed to Pro, or vice-versa)</li>
	  <li>Not explode. Hopefully.</li>
	</ol>
	If after running this update someone is still incorrectly set, seek help.
	<p></p>
    <div class="paybuttons"><a href="{{ url_for('update_payments') }}"><button class="paysystem" onclick="this.disabled = true">Process member data (takes 5-30 seconds)</a></div>
    <p>
	  
	</p><a href="{{ url_for('payments_reports') }}">Run reports related to Payments</a>
  </div>
{% endblock %}

